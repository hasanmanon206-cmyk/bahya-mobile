<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
<link rel="manifest" href="./manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù‚Ù‡ÙˆØ© Ø§Ù„Ø¨Ù„Ø© - ÙƒØ§Ø´ÙŠØ±</title>
  <style>
    :root{
      --bg:#041725;
      --panel:rgba(10,35,55,.55);
      --stroke:rgba(0,190,255,.35);
      --glow:rgba(0,190,255,.22);
      --txt:#eaf7ff;
      --muted:#9cc7da;
      --ok:#00ff99;
      --warn:#ffd34d;
      --bad:#ff4d4d;
      --btn:#00c8ff;
      --btn2:rgba(0,200,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, Arial;
      background: radial-gradient(1200px 700px at 70% 20%, rgba(0,190,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 20% 80%, rgba(0,255,153,.08), transparent 55%),
                  var(--bg);
      color:var(--txt);
      min-height:100vh;
    }
    .topbar{
      position:sticky; top:0; z-index:5;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px;
      background: linear-gradient(180deg, rgba(2,24,40,.92), rgba(2,24,40,.55));
      border-bottom:1px solid var(--stroke);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-weight:800; letter-spacing:.3px;
      color:#7fe6ff;
    }
    .chip{
      padding:6px 10px; border-radius:999px;
      background: var(--panel);
      border:1px solid var(--stroke);
      box-shadow: 0 0 0 1px rgba(0,190,255,.08) inset;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .top-right{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      justify-content:flex-start;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 360px; /* Ø£Ù‚Ø³Ø§Ù… / Ø£ØµÙ†Ø§Ù / Ù…Ù†ØªØ¬Ø§Øª / Ø³Ù„Ø© */
      gap:12px;
      padding:12px;
      height: calc(100vh - 58px);
    }
    .panel{
      background: var(--panel);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow), 0 0 40px var(--glow) inset;
      backdrop-filter: blur(10px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .panel h3{
      margin:0;
      padding:10px 12px;
      border-bottom:1px solid rgba(0,190,255,.18);
      color:#bfefff;
      font-size:14px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .list{
      padding:10px;
      overflow:auto;
      display:grid;
      gap:10px;
      align-content:start;
    }
    .gridBtns{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .btnCard{
      cursor:pointer;
      padding:12px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(0,200,255,.14), rgba(0,0,0,.06));
      border:1px solid rgba(0,190,255,.25);
      box-shadow: 0 0 0 1px rgba(0,190,255,.06) inset;
      color:var(--txt);
      text-align:center;
      user-select:none;
      transition:.15s transform, .15s box-shadow, .15s border-color;
    }
    .btnCard:hover{ transform: translateY(-1px); border-color:rgba(0,190,255,.5); box-shadow: 0 0 18px rgba(0,190,255,.18); }
    .btnCard.active{ outline:2px solid rgba(0,200,255,.55); }
    .small{font-size:12px;color:var(--muted); margin-top:6px}
    .productsGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .prod{
      text-align:right;
      padding:12px;
    }
    .prod .name{ font-weight:700; }
    .prod .price{ color:#7fe6ff; margin-top:6px; font-weight:800; }
    .basketTabs{
      display:flex; gap:6px; padding:10px; border-bottom:1px solid rgba(0,190,255,.18);
      overflow:auto;
    }
    .tab{
      padding:8px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
      border:1px solid rgba(0,190,255,.18);
      color:var(--muted);
      cursor:pointer;
      white-space:nowrap;
    }
    .tab.active{ background:rgba(0,200,255,.16); color:#d9fbff; border-color:rgba(0,200,255,.5); }
    .basketBody{
      padding:10px;
      overflow:auto;
      display:flex; flex-direction:column; gap:8px;
      flex:1;
    }
    .line{
      display:flex; justify-content:space-between; gap:8px;
      padding:10px;
      border-radius:12px;
      background:rgba(0,0,0,.12);
      border:1px solid rgba(0,190,255,.14);
    }
    .line b{color:#d9fbff}
    .line .meta{ color:var(--muted); font-size:12px; margin-top:4px; }
    .basketFooter{
      padding:10px;
      border-top:1px solid rgba(0,190,255,.18);
      display:grid;
      gap:8px;
    }
    .total{
      display:flex; justify-content:space-between; align-items:center;
      font-weight:900;
      color:var(--ok);
      font-size:18px;
    }
    .btnRow{
      display:grid; grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .btn{
      border:none; cursor:pointer;
      border-radius:12px;
      padding:10px;
      font-weight:800;
      background: var(--btn);
      color:#032033;
    }
    .btn.ghost{
      background: rgba(0,200,255,.14);
      border:1px solid rgba(0,200,255,.35);
      color:#c9f6ff;
    }

    /* Ù…ÙˆØ¯Ø§Ù„ */
    .modalBack{
      position:fixed; inset:0; display:none;
      background:rgba(0,0,0,.55);
      align-items:center; justify-content:center;
      z-index:50;
      padding:14px;
    }
    .modal{
      width:min(520px, 100%);
      background: rgba(8,28,45,.92);
      border:1px solid rgba(0,200,255,.35);
      border-radius:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55), 0 0 60px rgba(0,190,255,.15) inset;
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .modalHead{
      padding:12px 14px;
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid rgba(0,190,255,.18);
      color:#d9fbff;
      font-weight:900;
    }
    .close{ cursor:pointer; padding:6px 10px; border-radius:10px; background:rgba(0,0,0,.18); border:1px solid rgba(0,190,255,.18); color:#d9fbff; }
    .modalBody{ padding:14px; display:grid; gap:12px; }
    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .input{
      width:100%; padding:10px;
      border-radius:12px;
      border:1px solid rgba(0,190,255,.25);
      background:rgba(0,0,0,.18);
      color:var(--txt);
      font-size:16px;
      outline:none;
    }
    .sugar{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;
    }
    .sBtn{
      padding:10px; border-radius:12px;
      background:rgba(0,0,0,.14);
      border:1px solid rgba(0,190,255,.18);
      color:#d9fbff;
      cursor:pointer;
      text-align:center;
      font-weight:800;
    }
    .sBtn.active{ background:rgba(0,200,255,.16); border-color:rgba(0,200,255,.55); }
    .hint{ color:var(--muted); font-size:12px; line-height:1.5; }
    .danger{ color: var(--bad); }

    /* Ø²Ø± Ø§Ù„Ø²Ø¨ÙˆÙ† */
    .iconBtn{
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(0,200,255,.14);
      border:1px solid rgba(0,200,255,.35);
      color:#c9f6ff;
      font-weight:800;
    }
  </style>
  <link rel="stylesheet" href="src/erp.css">
</head>
<body>

  <div class="topbar">
    <div class="brand">
      <span>â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„Ø¨Ù„Ø©</span>
      <span class="chip">ERP Cashier</span>
    </div>

    <div class="top-right">
      <span class="chip">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <b id="uName">Ø§Ù„ÙƒØ§Ø´ÙŠØ±</b></span>
      <span class="chip">Ø§Ù„Ø³Ø§Ø¹Ø©: <b id="clock">--:--:--</b></span>
      <span class="chip">Ø±ØµÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©: <b id="shiftBal">0</b> $</span>
      <span class="iconBtn" onclick="openCustomerInbox()">ğŸ‘¤ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</span>
    </div>
  </div>

  <div class="grid">

    <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <div class="panel">
      <h3>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… <span class="small" id="catHint"></span></h3>
      <div class="list gridBtns" id="cats"></div>
    </div>

    <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
    <div class="panel">
      <h3>Ø§Ù„Ø£ØµÙ†Ø§Ù <span class="small" id="subHint"></span></h3>
      <div class="list gridBtns" id="subs"></div>
    </div>

    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="panel">
      <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <span class="small" id="prodHint"></span></h3>
      <div class="list productsGrid" id="prods"></div>
    </div>

    <!-- Ø§Ù„Ø³Ù„Ø© -->
    <div class="panel">
      <h3>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
      <div class="basketTabs" id="tabs"></div>
      <div class="basketBody" id="basket"></div>
      <div class="basketFooter">
        <div class="total">
          <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
          <span id="total">0 $</span>
        </div>
        <div class="btnRow">
          <button class="btn ghost" onclick="newBasket()">+ Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
          <button class="btn ghost" onclick="clearBasket()">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
        </div>
        <div class="btnRow">
          <button class="btn" onclick="saveInvoice('Ù†Ù‚Ø¯ÙŠ')">Ø­ÙØ¸ (Ù†Ù‚Ø¯ÙŠ)</button>
          <button class="btn" onclick="saveInvoice('Ø¢Ø¬Ù„')">Ø­ÙØ¸ (Ø¢Ø¬Ù„)</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div class="modalHead">
        <span id="mTitle">Ù…Ù†ØªØ¬</span>
        <span class="close" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</span>
      </div>
      <div class="modalBody">
        <div class="row2">
          <div>
            <div class="hint">Ø§Ù„Ø¹Ø¯Ø¯</div>
            <input class="input" id="mQty" type="number" min="1" value="1" />
          </div>
          <div>
            <div class="hint">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
            <input class="input" id="mNote" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙƒÙˆØ¨ ÙƒØ¨ÙŠØ±" />
          </div>
        </div>

        <div class="hint">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³ÙƒØ±</div>
        <div class="sugar" id="sugarBtns"></div>

        <div class="hint">
          âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· â€œØ¥Ø¶Ø§ÙØ©â€ Ø³ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø³Ù„Ø© ÙƒØ³Ø·Ø± Ù…Ø³ØªÙ‚Ù„ (ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø³ÙƒØ± Ù…Ø®ØªÙ„Ù).<br>
          <span class="danger">Ù‡Ø°Ø§ Ù‡Ùˆ Ù†ÙØ³ Ù…Ù†Ø·Ù‚ â€œØ§Ù„Ù…ÙˆØ¯Ù„â€ Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡ Ù„Ù„Ø¬Ø§Ø±Ø³ÙˆÙ† ÙˆØ§Ù„Ø²Ø¨ÙˆÙ† Ø£ÙŠØ¶Ø§Ù‹.</span>
        </div>

        <div class="btnRow">
          <button class="btn ghost" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" onclick="confirmAdd()">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† (ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø· Ø­Ø§Ù„ÙŠØ§Ù‹) -->
  <div class="modalBack" id="inboxBack">
    <div class="modal">
      <div class="modalHead">
        <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† (ÙˆØ§Ø¬Ù‡Ø©)</span>
        <span class="close" onclick="document.getElementById('inboxBack').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</span>
      </div>
      <div class="modalBody" id="inboxBody">
        <div class="hint">Ø­Ø§Ù„ÙŠØ§Ù‹ Ù‡Ø°Ù‡ ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·. Ù„Ø§Ø­Ù‚Ø§Ù‹: Ø¹Ù†Ø¯ ÙˆØ±ÙˆØ¯ Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ† ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø¹ ØµÙˆØª + Ù‚Ø¨ÙˆÙ„/Ø±ÙØ¶.</div>
        <div class="line">
          <div>
            <b>Ø²Ø¨ÙˆÙ†: Ø£Ø­Ù…Ø¯</b>
            <div class="meta">Ø·Ù„Ø¨: Ù‚Ù‡ÙˆØ© (Ø³ÙƒØ± ÙˆØ³Ø·) Ã— 1</div>
          </div>
          <div style="display:flex; gap:8px">
            <button class="btn ghost" style="width:auto" onclick="alert('ØªÙ… Ø§Ù„Ø±ÙØ¶ (ÙˆØ§Ø¬Ù‡Ø©)')">Ø±ÙØ¶</button>
            <button class="btn" style="width:auto" onclick="alert('ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ (ÙˆØ§Ø¬Ù‡Ø©)')">Ù‚Ø¨ÙˆÙ„</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù… =====
  const DB = {
    categories: [
      {id:"hot", name:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©"},
      {id:"cold", name:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø¨Ø§Ø±Ø¯Ø©"},
      {id:"shisha", name:"Ø£Ø±Ø§Ø¬ÙŠÙ„"},
      {id:"snack", name:"Ø³Ù†Ø§Ùƒ"}
    ],
    subs: [
      {id:"coffee", cat:"hot", name:"Ù‚Ù‡ÙˆØ©"},
      {id:"tea", cat:"hot", name:"Ø´Ø§ÙŠ"},
      {id:"juice", cat:"cold", name:"Ø¹ØµØ§Ø¦Ø±"},
      {id:"soda", cat:"cold", name:"ØºØ§Ø²ÙŠØ§Øª"},
      {id:"head", cat:"shisha", name:"Ø±Ø¤ÙˆØ³"},
      {id:"mix", cat:"shisha", name:"Ù…Ø¹Ø³Ù„"},
      {id:"chips", cat:"snack", name:"Ø´ÙŠØ¨Ø³"},
      {id:"sweet", cat:"snack", name:"Ø­Ù„ÙˆÙŠØ§Øª"}
    ],
    products: [
      {id:"p1", sub:"coffee", name:"Ù‚Ù‡ÙˆØ© Ø³Ø§Ø¯Ø©", price:1, hot:true},
      {id:"p2", sub:"coffee", name:"Ù†Ø³ÙƒØ§ÙÙŠÙ‡", price:2, hot:true},
      {id:"p3", sub:"tea", name:"Ø´Ø§ÙŠ", price:1, hot:true},
      {id:"p4", sub:"juice", name:"Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„", price:2, hot:false},
      {id:"p5", sub:"soda", name:"Ø¨ÙŠØ¨Ø³ÙŠ", price:1.5, hot:false},
      {id:"p6", sub:"mix", name:"Ù…Ø¹Ø³Ù„ ØªÙØ§Ø­ØªÙŠÙ†", price:3, hot:false},
      {id:"p7", sub:"head", name:"Ø±Ø£Ø³ VIP", price:2, hot:false},
      {id:"p8", sub:"chips", name:"Ø´ÙŠØ¨Ø³", price:1, hot:false},
    ]
  };

  // ===== Ø­Ø§Ù„Ø© ÙˆØ§Ø¬Ù‡Ø© =====
  let activeCat = DB.categories[0].id;
  let activeSub = null;

  const sugars = ["Ø³Ø§Ø¯Ø©","Ø³ÙƒØ± Ù‚Ù„ÙŠÙ„","ÙˆØ³Ø·","Ø¹ØµÙ…Ù„ÙŠ","Ø­Ù„ÙˆØ©"];
  let modalProd = null;
  let modalSugar = sugars[0];

  // ===== Ø³Ù„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© =====
  let baskets = [
    {id: "Ø³Ù„Ø© 1", items: []}
  ];
  let activeBasketIndex = 0;

  // ===== UI helpers =====
  function $(id){ return document.getElementById(id); }
  function money(x){ return (Math.round(x*100)/100).toString().replace(/\.0$/,''); }

  function tickClock(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    const ss = String(d.getSeconds()).padStart(2,'0');
    $("clock").textContent = `${hh}:${mm}:${ss}`;
  }
  setInterval(tickClock, 1000); tickClock();

  // ===== Render Ø§Ù„Ø£Ù‚Ø³Ø§Ù… =====
  function renderCats(){
    const wrap = $("cats");
    wrap.innerHTML = "";
    DB.categories.forEach(c=>{
      const div = document.createElement("div");
      div.className = "btnCard" + (c.id===activeCat ? " active" : "");
      div.innerHTML = `<div style="font-weight:900">${c.name}</div><div class="small">Ø§Ø¶ØºØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>`;
      div.onclick = ()=>{
        activeCat = c.id;
        activeSub = null;
        renderAll();
      };
      wrap.appendChild(div);
    });
    $("catHint").textContent = DB.categories.find(x=>x.id===activeCat)?.name || "";
  }

  // ===== Render Ø§Ù„Ø£ØµÙ†Ø§Ù =====
  function renderSubs(){
    const wrap = $("subs");
    wrap.innerHTML = "";
    const list = DB.subs.filter(s=>s.cat===activeCat);
    if(!activeSub && list.length) activeSub = list[0].id;

    list.forEach(s=>{
      const div = document.createElement("div");
      div.className = "btnCard" + (s.id===activeSub ? " active" : "");
      div.innerHTML = `<div style="font-weight:900">${s.name}</div><div class="small">Ø§ØµÙ†Ø§Ù Ø§Ù„Ù‚Ø³Ù…</div>`;
      div.onclick = ()=>{
        activeSub = s.id;
        renderProducts();
      };
      wrap.appendChild(div);
    });

    $("subHint").textContent = DB.subs.find(x=>x.id===activeSub)?.name || "Ø§Ø®ØªØ± ØµÙ†Ù";
  }

  // ===== Render Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =====
  function renderProducts(){
    const wrap = $("prods");
    wrap.innerHTML = "";

    if(!activeSub){
      $("prodHint").textContent = "Ø§Ø®ØªØ± ØµÙ†Ù Ø£ÙˆÙ„Ø§Ù‹";
      return;
    }
    $("prodHint").textContent = "Ø§Ø¶ØºØ· Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ø¥Ø¶Ø§ÙØªÙ‡";
    const list = DB.products.filter(p=>p.sub===activeSub);

    list.forEach(p=>{
      const div = document.createElement("div");
      div.className = "btnCard prod";
      div.innerHTML = `
        <div class="name">${p.name}</div>
        <div class="small">${p.hot ? "ğŸ”¥ Ø³Ø§Ø®Ù†" : "â„ï¸ Ø¨Ø§Ø±Ø¯"}</div>
        <div class="price">${money(p.price)} $</div>
      `;
      div.onclick = ()=> openModal(p);
      wrap.appendChild(div);
    });
  }

  // ===== Tabs Ø§Ù„Ø³Ù„Ø§Øª =====
  function renderTabs(){
    const wrap = $("tabs");
    wrap.innerHTML = "";
    baskets.forEach((b,idx)=>{
      const t = document.createElement("div");
      t.className = "tab" + (idx===activeBasketIndex ? " active" : "");
      t.textContent = b.id;
      t.onclick = ()=>{ activeBasketIndex = idx; renderBasket(); renderTabs(); };
      wrap.appendChild(t);
    });
  }

  // ===== Render Ø§Ù„Ø³Ù„Ø© =====
  function renderBasket(){
    const wrap = $("basket");
    wrap.innerHTML = "";
    const items = baskets[activeBasketIndex].items;

    let total = 0;
    items.forEach((it, i)=>{
      total += it.price * it.qty;
      const div = document.createElement("div");
      div.className = "line";
      div.innerHTML = `
        <div>
          <b>${it.name}</b>
          <div class="meta">Ø³ÙƒØ±: ${it.sugar} | Ø¹Ø¯Ø¯: ${it.qty}${it.note ? " | " + it.note : ""}</div>
        </div>
        <div style="text-align:left">
          <div style="font-weight:900;color:#7fe6ff">${money(it.price * it.qty)} $</div>
          <div class="small" style="cursor:pointer;color:#ff9aa2" onclick="removeLine(${i})">Ø­Ø°Ù</div>
        </div>
      `;
      wrap.appendChild(div);
    });

    $("total").textContent = `${money(total)} $`;
  }

  function removeLine(i){
    baskets[activeBasketIndex].items.splice(i,1);
    renderBasket();
  }

  // ===== Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø¯Ø¯ + Ø³ÙƒØ±) =====
  function openModal(p){
    modalProd = p;
    modalSugar = sugars[0];
    $("mTitle").textContent = p.name;
    $("mQty").value = 1;
    $("mNote").value = "";

    const sWrap = $("sugarBtns");
    sWrap.innerHTML = "";
    sugars.forEach(s=>{
      const b = document.createElement("div");
      b.className = "sBtn" + (s===modalSugar ? " active" : "");
      b.textContent = s;
      b.onclick = ()=>{
        modalSugar = s;
        [...sWrap.children].forEach(x=>x.classList.remove("active"));
        b.classList.add("active");
      };
      sWrap.appendChild(b);
    });

    $("modalBack").style.display = "flex";
  }

  function closeModal(){
    $("modalBack").style.display = "none";
  }

  function confirmAdd(){
    const qty = Math.max(1, parseInt($("mQty").value || "1",10));
    const note = $("mNote").value.trim();

    // Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙƒØ±Ø§Ø±
    baskets[activeBasketIndex].items.push({
      productId: modalProd.id,
      name: modalProd.name,
      price: modalProd.price,
      qty,
      sugar: modalSugar,
      note
    });

    closeModal();
    renderBasket();
  }

  // ===== Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ù„Ø© =====
  function newBasket(){
    const n = baskets.length + 1;
    baskets.push({id:`Ø³Ù„Ø© ${n}`, items:[]});
    activeBasketIndex = baskets.length - 1;
    renderTabs();
    renderBasket();
  }

  function clearBasket(){
    baskets[activeBasketIndex].items = [];
    renderBasket();
  }

  function saveInvoice(type){
    const items = baskets[activeBasketIndex].items;
    if(!items.length){ alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©"); return; }

    const all = JSON.parse(localStorage.getItem("invoices") || "[]");
    all.push({
      id: "INV-" + Date.now(),
      type,
      date: Date.now(),
      items
    });
    localStorage.setItem("invoices", JSON.stringify(all));

    // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© (ÙˆØ§Ø¬Ù‡Ø©)
    let total = items.reduce((s,it)=> s + it.price*it.qty, 0);
    const cur = parseFloat(localStorage.getItem("shiftBal") || "0");
    const next = cur + total;
    localStorage.setItem("shiftBal", String(next));
    $("shiftBal").textContent = money(next);

    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ("+type+")");
    newBasket(); // Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ (ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª)
  }

  function openCustomerInbox(){
    $("inboxBack").style.display = "flex";
  }

  // ===== init =====
  function init(){
    // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙˆØ§Ø¬Ù‡Ø©)
    $("uName").textContent = localStorage.getItem("userName") || "Ø§Ù„ÙƒØ§Ø´ÙŠØ±";

    // Ø±ØµÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©
    const sb = parseFloat(localStorage.getItem("shiftBal") || "0");
    $("shiftBal").textContent = money(sb);

    renderAll();
  }

  function renderAll(){
    renderCats();
    renderSubs();
    renderProducts();
    renderTabs();
    renderBasket();
  }

  init();
</script>
<div id="app"></div>
<script type="module" src="src/router.js"></script>
</body>
</html>
